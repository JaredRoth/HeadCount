require_relative 'repository'
require_relative 'enrollment'
require_relative 'module_helper'
require 'csv'


class EnrollmentRepository < Repository
  include Helper

  attr_reader :enrollments

  def initialize
    @enrollments = []
    @data = load_data({
      :enrollment => {
        :kindergarten => "./data/Kindergartners in full-day program.csv",
        :high_school_graduation => "./data/High school graduation rates.csv"
      }
    })
  end

  def group_data(data)
    data_grouped_by_location = data.group_by { |row| row[:location] }
  end

  def enrollment_csv_hash(data_grouped_by_location)
    hash_result = {}
    data_grouped_by_location.each do |key,value|
      one_districts_info = {}
      value.each do |line|
        one_districts_info[line[:timeframe]] = sanitize_data(line[:data])
      end
      hash_result[key] = one_districts_info
    end
    hash_result
  end

  def find_by_name(location)
    enrollments.find { |enrollment| enrollment.name.upcase == location.upcase}
  end
end
